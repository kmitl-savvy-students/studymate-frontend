<div class="my-4">
	<h1 class="text-xl font-semibold">คำนวณเกรด</h1>
	<h3 class="text-sm opacity-50">คุณ {{ currentUser?.firstname }} {{ currentUser?.lastname }}</h3>
</div>

<div *ngIf="!transcript && !isFetchingTranscript" class="text-sm">ไม่มีข้อมูลเกรด</div>

<div *ngIf="isFetchingTranscript" class="text-sm">กำลังโหลดข้อมูล...</div>

<div *ngIf="transcript && groupedTranscriptDetails.length > 0" class="mb-5">
	<button class="mb-3 rounded bg-red-100 px-2 py-0.5 text-sm text-red-800 hover:bg-red-200" (click)="onResetAllGrades()">รีเซ็ตเกรดทั้งหมด</button>

	<div *ngFor="let group of groupedTranscriptDetails" class="mb-2 border-b border-gray-300 pb-5">
		<div *ngIf="group.year == 0 && group.term == 0" class="mb-1 font-semibold">Transfer Credit</div>
		<div *ngIf="group.year != 0 && group.term != 0" class="mb-1 font-semibold">ปีการศึกษา {{ group.year }} / ภาคเรียนที่ {{ group.term }}</div>

		<table class="w-full table-fixed border border-gray-300 text-sm leading-none">
			<thead>
				<tr class="bg-gray-100">
					<th class="w-2/12 border px-1 py-0.5">รหัสวิชา</th>
					<th class="w-4/12 border px-1 py-0.5">ชื่อวิชา (EN)</th>
					<th class="w-2/12 border px-1 py-0.5">หน่วยกิต</th>
					<th class="w-2/12 border px-1 py-0.5">เกรด</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let detail of group.details" class="hover:bg-gray-50">
					<td class="border px-1 py-0.5 text-center">
						{{ detail.subject?.id }}
					</td>

					<td class="max-w-[150px] overflow-hidden truncate text-ellipsis whitespace-nowrap border px-1 py-0.5" title="{{ detail.subject?.name_en }}">
						{{ detail.subject?.name_en }}
					</td>

					<td class="border px-1 py-0.5 text-center">
						{{ detail.subject?.credit }}
					</td>

					<td class="border px-1 py-0.5 text-center">
						<select class="rounded border border-gray-300 px-1 text-sm leading-none" [(ngModel)]="detail.grade" (ngModelChange)="onGradeChange(detail, $any($event))">
							<option value="">(ไม่มี)</option>
							<option value="A">A</option>
							<option value="B+">B+</option>
							<option value="B">B</option>
							<option value="C+">C+</option>
							<option value="C">C</option>
							<option value="D+">D+</option>
							<option value="D">D</option>
							<option value="F">F</option>
							<option value="S">S</option>
							<option value="U">U</option>
							<option value="X">X</option>
						</select>
					</td>
				</tr>
			</tbody>
		</table>

		<div class="mt-1 flex flex-row gap-3">
			<div>ค่าเกรดเฉลี่ยในภาคเรียน (GPS): {{ group.gps.toFixed(2) }}</div>
			<div>ค่าเกรดเฉลี่ยสะสม (GPA): {{ group.gpa.toFixed(2) }}</div>
		</div>
	</div>
</div>
