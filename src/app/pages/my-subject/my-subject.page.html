<div class="mt-4 flex justify-between">
	<p class="text-xl font-medium text-dark-100">{{ curriculumName }}</p>
	<div class="flex gap-x-2">
		<!-- Delete Transcript Button -->
		<button
			data-modal-target="confirm-delete-modal"
			data-modal-toggle="confirm-delete-modal"
			class="rounded-lg border border-red-400 bg-white px-3 py-1.5 text-base font-medium text-dark-100 hover:bg-red-400 hover:text-white focus:bg-red-400 focus:text-white"
		>
			ลบข้อมูล Transcript
		</button>

		<!-- Upload Transcript Button -->
		<button
			data-modal-target="import-transcript-modal"
			data-modal-toggle="import-transcript-modal"
			class="rounded-lg bg-main-100 px-3 py-1.5 text-base font-medium text-white hover:bg-main-120"
		>
			อัปโหลด Transcript
		</button>
	</div>
</div>

<!-- Delete Transcript Modal -->
<sdm-confirm-delete-modal
	modalID="confirm-delete-modal"
	text="คุณต้องการลบข้อมูล Transcript ใช่หรือไม่?"
	subtext="*หากลบแล้วจะไม่สามารถกู้คืนได้ ต้องอัปโหลดใหม่เท่านั้น"
	[deleteFunction]="deleteTranscriptData.bind(this)"
></sdm-confirm-delete-modal>

<!-- Upload Transcript Modal -->
<sdm-import-transcript-modal
	modalID="import-transcript-modal"
	headerModal="อัปโหลดไฟล์ Transcript ของคุณ"
></sdm-import-transcript-modal>

<!-- Loading and Error States -->
<div
	*ngIf="!isDataLoaded && !errorMessage"
	class="mt-9 text-center text-dark-100"
>
	<p>กำลังโหลดข้อมูล...</p>
</div>
<div *ngIf="errorMessage" class="mt-9 text-center text-red-500">
	<p>{{ errorMessage }}</p>
</div>

<!-- Transcript Data Grouped by Year and Semester -->
<div class="mt-9" *ngIf="isDataLoaded && !errorMessage">
	<ng-container
		*ngIf="transcriptData && transcriptData.length > 0; else noData"
	>
		<ng-container *ngFor="let group of groupByYearSemester(transcriptData)">
			<div class="mb-6 border-b pb-4">
				<!-- If year = -1, show "วิชากิตเทียบโอน" -->
				<h2 class="mb-2 text-lg font-semibold text-dark-100">
					<ng-container *ngIf="group.year === -1; else normalHeading">
						วิชากิตเทียบโอน
					</ng-container>
					<ng-template #normalHeading>
						ปีการศึกษา: {{ group.year || '-' }} / ภาคการศึกษา: {{
						group.semester || '-' }}
					</ng-template>
				</h2>

				<table
					class="w-full border border-gray-300 text-left text-sm text-gray-500 dark:text-gray-400"
					style="table-layout: fixed"
				>
					<thead class="border-b border-gray-300 bg-gray-100">
						<tr>
							<!-- Each column takes 25% width -->
							<th
								class="px-4 py-2 font-medium text-dark-100"
								style="width: 25%"
							>
								รหัสวิชา
							</th>
							<th
								class="px-4 py-2 font-medium text-dark-100"
								style="width: 25%"
							>
								ชื่อวิชา
							</th>
							<th
								class="px-4 py-2 font-medium text-dark-100"
								style="width: 25%"
							>
								เกรด
							</th>
							<th
								class="px-4 py-2 font-medium text-dark-100"
								style="width: 25%"
							>
								หน่วยกิต
							</th>
						</tr>
					</thead>
					<tbody>
						<tr
							*ngFor="let subject of group.subjects"
							class="border-b border-gray-200"
						>
							<td class="px-4 py-2">
								{{ subject.subject?.id || '-' }}
							</td>
							<td
								class="overflow-hidden text-ellipsis whitespace-nowrap px-4 py-2"
								[title]="subject.subject?.subject_ename || subject.subject?.subject_tname || '-'"
								style="max-width: 0; width: 100%"
							>
								{{ subject.subject?.subject_ename ||
								subject.subject?.subject_tname || '-' }}
							</td>
							<td class="px-4 py-2">
								{{ subject.grade === '0' ? '-' : subject.grade
								|| '-' }}
							</td>
							<td class="px-4 py-2">
								{{ subject.credit || '-' }}
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</ng-container>

		<!-- Display sum of credits where grade is not X -->
		<div class="mt-4 font-medium text-dark-100">
			หน่วยกิตรวม (ไม่รวมวิชาที่เกรดเป็น X): {{
			calculateTotalCreditsNonX() }}
		</div>
	</ng-container>
</div>

<ng-template #noData>
	<div class="mt-9 text-center text-dark-100">
		<p>ไม่มีข้อมูล Transcript</p>
	</div>
</ng-template>
